# 3 - Transformación y complemento de datos

Seccion destinada para la limpieza y transformacion y generacion de nuevos datos/campos dentro de BigQuery 

**Tabla contenidos de seccion**

- [3.1 - Generacion de ubicaciones geograficas en tabla ```asistencia```](#3.1-Generacion-de-ubicaciones-geograficas-en-tabla-asistencia)
- [3.2 - Limpieza de campo ```ASIS_PROMEDIO``` dentro de tabla ```asistencia```](#3.2-Limpieza-de-campo-ASIS_PROMEDIO-dentro-de-tabla-asistencia)
- [3.3 - Generacion de datos de coordenadas geograficas en tabla ```info_comunas```](#3.3-Generacion-de-datos-de-coordenadas-geograficas-en-tabla-info_comunas)
- [3.4 - Limpieza de datos de comunas en tabla ```info_comunas```](#3.4-Limpieza-de-datos-de-comunas-en-tabla-info_comunas)
- [3.5 - Insercion de datos de coordenadas geograficas de comunas en tabla ```asistencia``` a partir de informacion en tabla ```info_comunas```](#3.5-Insercion-de-datos-de-coordenadas-geograficas-de-comunas-en-tabla-asistencia-a-partir-de-informacion-en-tabla-info_comunas)
- [3.6 - Insercion de datos de coordenadas geograficas de regiones en tabla ```asistencia```](#3.6-Insercion-de-datos-de-coordenadas-geograficas-de-regiones-en-tabla-asistencia)
- [3.7 - Insercion de datos ubicacion de regiones de Chile](#3.7-Insercion-de-datos-ubicacion-de-regiones-de-Chile)
- [3.8 - Vistas para obtencion de datos](#3.8-Vistas-para-obtencion-de-datos)

### 3.1 - Generacion de ubicaciones geograficas en tabla ```asistencia```

Con el fin de generar datos de ubicacion geografica de las comunas y regiones en la tabla ```asistencia```, se generan los campos 

- LAT_COMUNA: representando la latitud de la comuna
- LONG_COMUNA: representando la longitud de la comuna
- TIPO_REGION: representando si es una region que se encuentra en el extremo NORTE, CENTRO o SUR de Chile
- LAT_REGION: representando la latitud de la region
- LONG_REGION: representando la longitud de la region

Para la generacion de estos campos, se debe ejecutar las siguentes sentencias DDL desde el editor de BigQuery:

``` bigquery
ALTER TABLE `infinite-lens-352300.data_chile.asistencia` ADD COLUMN LAT_COMUNA STRING;
ALTER TABLE `infinite-lens-352300.data_chile.asistencia` ADD COLUMN LONG_COMUNA STRING;
ALTER TABLE `infinite-lens-352300.data_chile.asistencia` ADD COLUMN TIPO_REGION STRING;
ALTER TABLE `infinite-lens-352300.data_chile.asistencia` ADD COLUMN LAT_REGION STRING;
ALTER TABLE `infinite-lens-352300.data_chile.asistencia` ADD COLUMN LONG_REGION STRING;
```

### 3.2 - Limpieza de campo ```ASIS_PROMEDIO``` dentro de tabla ```asistencia```

Al hacer la carga de datos, se detecta que el campo ASIS_PROMEDIO se representa con el porcentaje de asistencia, es decir, entre los campos DIAS_ASISTIDOS y DIAS_TRABAJADOS. 
Este campo queda en BigQuery como ```1``` en el caso de que el estudiante tenga un 100% de asistencia, y en los demas casos, se representa con el patron ```XY.YZ```. 
Para subsanar esto se debe ejecutar la sentencia DML: 

``` bigquery
UPDATE `infinite-lens-352300.data_chile.asistencia` SET
  ASIS_PROMEDIO = ((DIAS_ASISTIDOS * 100) / DIAS_TRABAJADOS)
WHERE 
  MES_ESCOLAR IS NOT NULL
AND 
  DIAS_TRABAJADOS != 0;
```

### 3.3 - Generacion de datos de coordenadas geograficas en tabla ```info_comunas```

Originalmente los dataset (archivos ```.csv```) de asistencia, no contienen datos de las coordenadas geograficas de las comunas o regiones de Chile, 
con esto, se disponibiliza un archivo con esta informacion en [github.com/napb](https://github.com/napb/abd_tarea1/blob/master/3/comunas.csv) 
el cual es cargado en bigquery en la tabla ```info_comunas``` de BigQuery, con la ejecucion del siguente comando en Google Cloud Shell

``` commandline
python3 3/3-load-comunas-file.py
```

### 3.4 - Limpieza de datos de comunas en tabla ```info_comunas```

Hay comunas y localidades dentro de Chile, que tienen nombres confusos, dando resultados erroneos al hacer ```joins``` con tablas.
Para poder realizar acciones de pareo en la informacion se generan las siguentes sentencias DML: 

``` bigquery
UPDATE `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE = "CALERA" WHERE UPPER(NOMBRE) = "LA CALERA";
UPDATE `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE = "MAULLIN" WHERE UPPER(NOMBRE) = "MAULLIN";
UPDATE `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE = "TREHUACO" WHERE UPPER(NOMBRE) = "TREGUACO";
UPDATE `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE = "PAIGUANO" WHERE UPPER(NOMBRE) = "PAIHUANO";
UPDATE `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE = "VICHUQUEN" WHERE UPPER(NOMBRE) = "VICHUQUEN";
UPDATE `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE = "LLAILLAY" WHERE UPPER(NOMBRE) = "LLAY-LLAY";
UPDATE `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE = "TILTIL" WHERE UPPER(NOMBRE) = "TIL TIL";
UPDATE `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE = "RANQUIL" WHERE UPPER(NOMBRE) = "RANQUIL";
```

### 3.5 - Insercion de datos de coordenadas geograficas de comunas en tabla ```asistencia``` a partir de informacion en tabla ```info_comunas```

Para generar la informacion de coordenadas geograficas dentro de la tabla ```asistencia```, llenando los campos ```LAT_COMUNA``` y ```LONG_COMUNA```, 
se genera la siguente sentencia DML para poder sacar estos datos desde la tabla ```info_comunas``` hacia ```asistencia```

``` bigquery
UPDATE `infinite-lens-352300.data_chile.asistencia` a SET
  a.LAT_COMUNA = b.LATTITUD,
  a.LONG_COMUNA = b.LONGITUD
FROM 
  `infinite-lens-352300.data_chile.info_comunas` b
WHERE 
  REGEXP_REPLACE(NORMALIZE(UPPER(a.NOM_COM_RBD), NFD), r'\pM', '') = REGEXP_REPLACE(NORMALIZE(UPPER(b.NOMBRE), NFD), r'\pM', '')
AND 
  a.MES_ESCOLAR IS NOT NULL;
```

Para la validacion de esta ejecucion en la tabla asistencia, se debe ejecutar la siguente sentencia, la cual debe retornar 345 elementos (correspondientes a las 345 comunas de Chile):
``` bigquery
SELECT
    NOM_COM_RBD,
    LAT_COMUNA,
    LONG_COMUNA  
FROM 
  `infinite-lens-352300.data_chile.asistencia`
WHERE 
  MES_ESCOLAR IS NOT NULL
GROUP BY
  NOM_COM_RBD,
  LAT_COMUNA,
  LONG_COMUNA
```

### 3.6 - Insercion de datos de coordenadas geograficas de regiones en tabla ```asistencia```

Para generar la informacion de coordenadas geograficas dentro de la tabla ```asistencia```, llenando los campos ```LAT_REGION``` y ```LONG_REGION```, 
se genera la siguente sentencia DML:

``` bigquery
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '18°28′30″', LONG_REGION = '70°18′52″' WHERE COD_REG_RBD = 15 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '20°17′00″', LONG_REGION = '69°20′00″' WHERE COD_REG_RBD = 1 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '23°38′39″', LONG_REGION = '70°24′39″' WHERE COD_REG_RBD = 2 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '27°22′00″', LONG_REGION = '70°19′56″' WHERE COD_REG_RBD = 3 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '29°54′28″', LONG_REGION = '71°15′15″' WHERE COD_REG_RBD = 4 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '33°03′47″', LONG_REGION = '71°38′22″' WHERE COD_REG_RBD = 5 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '33°26′16″', LONG_REGION = '70°39′01″' WHERE COD_REG_RBD = 13 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '34°22′19″', LONG_REGION = '71°07′28″' WHERE COD_REG_RBD = 6 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '35°25′36″', LONG_REGION = '71°40′18″' WHERE COD_REG_RBD = 7 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '36°37′00″', LONG_REGION = '71°57′00″' WHERE COD_REG_RBD = 16 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '36°46′22″', LONG_REGION = '73°03′47″' WHERE COD_REG_RBD = 8 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '38°54′00″', LONG_REGION = '72°40′00″' WHERE COD_REG_RBD = 9 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '39°48′30″', LONG_REGION = '73°14′30″' WHERE COD_REG_RBD = 14 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '41°28′18″', LONG_REGION = '72°56′12″' WHERE COD_REG_RBD = 10 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '45°34′12″', LONG_REGION = '72°03′58″' WHERE COD_REG_RBD = 11 AND MES_ESCOLAR IS NOT NULL;
UPDATE `infinite-lens-352300.data_chile.asistencia` SET LAT_REGION = '53°09′45″', LONG_REGION = '70°55′21″' WHERE COD_REG_RBD = 12 AND MES_ESCOLAR IS NOT NULL;
```

Para la validacion de esta ejecucion en la tabla asistencia, se debe ejecutar la siguente sentencia, la cual debe retornar 16 elementos (correspondientes a las 16 regiones de Chile):
``` bigquery
SELECT
    NOM_COM_RBD,
    LAT_COMUNA,
    LONG_COMUNA  
FROM 
  `infinite-lens-352300.data_chile.asistencia`
WHERE 
  MES_ESCOLAR IS NOT NULL
GROUP BY
  NOM_COM_RBD,
  LAT_COMUNA,
  LONG_COMUNA
```

### 3.7 - Insercion de datos ubicacion de regiones de Chile

Con motivo de la ultima sub-division de regiones de Chile, se genera el campo ```TIPO_REGION``` 
para poder ubicar al usuario en el caso de necesitar saber en que lugar fisico se encuentra cada territorio. Para esto 
se debe ejecutar la siguente sentencia DML:

``` bigquery
UPDATE `infinite-lens-352300.data_chile.asistencia` SET 
  TIPO_REGION =
  CASE  
    WHEN 
      COD_REG_RBD = 1 OR 
      COD_REG_RBD = 3 OR 
      COD_REG_RBD = 2 OR
      COD_REG_RBD = 4 OR
      COD_REG_RBD = 15
        THEN 'NORTE'
    WHEN  
      COD_REG_RBD = 5 OR 
      COD_REG_RBD = 6 OR 
      COD_REG_RBD = 7 OR
      COD_REG_RBD = 13 OR
      COD_REG_RBD = 16 
        THEN 'CENTRO'
    WHEN 
      COD_REG_RBD = 8 OR 
      COD_REG_RBD = 9 OR 
      COD_REG_RBD = 10 OR 
      COD_REG_RBD = 11 OR
      COD_REG_RBD = 12 OR
      COD_REG_RBD = 14 
        THEN 'SUR'
    END
WHERE 
  MES_ESCOLAR IS NOT NULL;
```

### 3.8 - Vistas para obtencion de datos

Con motivo de obtencion de manera mas acotada y limpia de datos, se generan las vistas 

- ```v_asistencia```
- ```v_asistencia_comuna```
- ```v_asistencia_region_anio``` 
- ```v_asistencia_region_mes_anio``` 

Para la creacion de estas vistas, se generan las siguentes sentencias DDL que deben ser ejecutadas en el editor de BigQuery:

``` bigquery
CREATE OR REPLACE VIEW data_chile.v_asistencia(
    AGNO,
    MES_ESCOLAR,
    RBD,
    DGV_RBD,
    NOM_RBD,
    COD_REG_RBD,
    NOM_REG_RBD_A,
    COD_PRO_RBD,
    COD_COM_RBD,
    NOM_COM_RBD,
    COD_DEPROV_RBD,
    NOM_DEPROV_RBD,
    RURAL_RBD,
    RURAL_RBD_GLOSA,
    COD_DEPE,
    COD_DEPE_GLOSA,
    COD_DEPE2,
    COD_DEPE2_GLOSA,
    COD_ENSE,
    COD_ENSE_GLOSA,
    COD_ENSE2,
    COD_ENSE2_GLOSA,
    COD_GRADO,
    COD_GRADO_GLOSA,
    LET_CUR,
    MRUN,
    GEN_ALU,
    GEN_ALU_GLOSA,
    FEC_NAC_ALU,
    COD_COM_ALU,
    NOM_COM_ALU,
    DIAS_ASISTIDOS,
    DIAS_TRABAJADOS,
    ASIS_PROMEDIO,
    LAT_COMUNA, 
    LONG_COMUNA,
    TIPO_REGION,
    LAT_REGION,
    LONG_REGION
) AS (
SELECT
    AGNO,
    MES_ESCOLAR,
    RBD,
    DGV_RBD,
    NOM_RBD,
    COD_REG_RBD,
    CASE NOM_REG_RBD_A
      WHEN 'ARAUC' THEN 'REGION DE LA ARAUCANIA'
      WHEN 'ATCMA' THEN 'REGION DE ATACAMA'
      WHEN 'COQ' THEN 'REGION DE COQUIMBO'
      WHEN 'RM' THEN 'REGION METROPOLITANA'
      WHEN 'LAGOS' THEN 'REGION DE LOS LAGOS'
      WHEN 'AYSEN' THEN 'REGION DE AYSEN'
      WHEN 'NUBLE' THEN 'REGION DE ÑUBLE'
      WHEN 'AYP' THEN 'REGION DE ARICA Y PARINACOTA'
      WHEN 'TPCA' THEN 'REGION DE TARAPACA'
      WHEN 'BBIO' THEN 'REGION DEL BIO-BIO'
      WHEN 'VALPO' THEN 'REGION DE VALPARAISO'
      WHEN 'RIOS' THEN 'REGION DE LOS RIOS'
      WHEN 'MAG' THEN 'REGION DE MAGALLANES'
      WHEN 'LGBO' THEN 'REGION DE LIBERTADOR BERNARDO OHIGGINS'
      WHEN 'ANTOF' THEN 'REGION DE ANTOFAGASTA'
      ELSE 'N/A'
      END
      AS NOM_REG_RBD_A,
    COD_PRO_RBD,
    COD_COM_RBD,
    NOM_COM_RBD,
    COD_DEPROV_RBD,
    NOM_DEPROV_RBD,

    RURAL_RBD,
    CASE RURAL_RBD
      WHEN 0 THEN 'URBANA'
      WHEN 1 THEN 'RURAL'
      ELSE 'N/A'
      END
      AS RURAL_RBD_GLOSA,

    COD_DEPE,
    CASE COD_DEPE
      WHEN 1 THEN 'CORPORACION MUNICIPAL'
      WHEN 2 THEN 'MUNICIPAL DAEM'
      WHEN 3 THEN 'PARTICULAR SUVENCIONADO'
      WHEN 4 THEN 'PARTICULAR PAGADO'
      WHEN 5 THEN 'CORPORACION DE ADMINISTRACION DELEGADA'
      WHEN 6 THEN 'SERVICIO LOCAL DE EDUCACION'
      ELSE 'N/A'
      END
      AS COD_DEPE_GLOSA,

    COD_DEPE2,
    CASE COD_DEPE2
      WHEN '1' THEN 'CORPORACION MUNICIPAL'
      WHEN '2' THEN 'MUNICIPAL DAEM'
      WHEN '3' THEN 'PARTICULAR SUVENCIONADO'
      WHEN '4' THEN 'PARTICULAR PAGADO'
      WHEN '5' THEN 'CORPORACION DE ADMINISTRACION DELEGADA'
      WHEN '6' THEN 'SERVICIO LOCAL DE EDUCACION'
      ELSE 'N/A'
      END
      AS COD_DEPE2_GLOSA,
    COD_ENSE,
    CASE COD_ENSE 
      WHEN 10 THEN 'EDUCACIÓN PARVULARIA'
      WHEN 110 THEN 'ENSEÑANZA BÁSICA'
      WHEN 165 THEN 'EDUCACIÓN DE ADULTOS SIN OFICIOS(DECRETO 584/2007)'
      WHEN 167 THEN 'EDUCACIÓN DE ADULTOS CON OFICIOS(DECRETO 584/2007Y999/2009)'
      WHEN 211 THEN 'EDUCACIÓN ESPECIAL DISCAPACID ADAUDITIVA'
      WHEN 212 THEN 'EDUCACIÓN ESPECIAL DISCAPACIDAD INTELECTUAL'
      WHEN 213 THEN 'EDUCACIÓN ESPECIAL DISCAPACIDAD VISUAL'
      WHEN 214 THEN 'EDUCACIÓN ESPECIAL TRASTORNOS ESPECÍFICOS DEL LENGUAJE'
      WHEN 215 THEN 'EDUCACIÓN ESPECIAL TRASTORNOS MOTORES'
      WHEN 216 THEN 'EDUCACIÓN ESPECIAL AUTISMO'
      WHEN 217 THEN 'EDUCACIÓN ESPECIAL DISCAPACIDAD GRAVES ALTERACIONES EN LA CAPACIDAD DE RELACIÓN Y COMUNICACIÓN'
      WHEN 218 THEN 'EDUCACIÓN ESPECIAL DISCAPACIDAD MÚLTIPLE'
      WHEN 219 THEN 'EDUCACIÓN ESPECIAL SORDO CEGUERA'
      WHEN 299 THEN 'OPCIÓN 4 PROGRAMA INTEGRACIÓN ESCOLAR'
      WHEN 310 THEN 'ENSEÑANZA MEDIA H-C NIÑOS Y JÓVENES'
      WHEN 363 THEN 'EDUCACIÓN MEDIAH-CADULTOS(DECRETON°1000/2009)'
      WHEN 410 THEN 'ENSEÑANZA MEDIA TÉCNICO –PROFESIONAL COMERCIAL NIÑOS'
      WHEN 463 THEN 'EDUCACIÓN MEDIA T-P COMERCIAL ADULTOS (DECRETO N° 1000/2009) 510 ENSEÑANZA MEDIA T-P INDUSTRIAL NIÑOS'
      WHEN 563 THEN 'EDUCACIÓN MEDIA T-P INDUSTRIAL ADULTOS (DECRETO N° 1000/2009) 610 ENSEÑANZA MEDIA T-P TÉCNICA NIÑOS'
      WHEN 663 THEN 'EDUCACIÓN MEDIA T-P TÉCNICA ADULTOS (DECRETO N° 1000/2009) 710 ENSEÑANZA MEDIA T-P AGRÍCOLA NIÑOS'
      WHEN 763 THEN 'EDUCACIÓN MEDIA T-P AGRÍCOLA ADULTOS (DECRETO N° 1000/2009) 810 ENSEÑANZA MEDIA T-P MARÍTIMA NIÑOS'
      WHEN 863 THEN 'ENSEÑANZA MEDIA T-P MARÍTIMA ADULTOS (DECRETO N° 1000/2009) 910 ENSEÑANZA MEDIA ARTÍSTICAN IÑOS Y JÓVENES'
      ELSE 'N/A'
      END
      AS COD_ENSE_GLOSA,
    COD_ENSE2,
    CASE COD_ENSE2
      WHEN 1 THEN 'EDUCACIÓN PARVULARIA'
      WHEN 2 THEN 'ENSEÑANZA BASICA NIÑOS'
      WHEN 3 THEN 'ENSEÑANZA BASICA ADULTOS'
      WHEN 4 THEN 'EDUCACIÓN ESPECIAL'
      WHEN 5 THEN 'ENSEÑANZA MEDIA HUMANISTICO CIENTIFICA JOVENES'
      WHEN 6 THEN 'ENSEÑANZA MEDIA HUMANISTICO CIENTIFICA ADULTOS'
      WHEN 7 THEN 'ENSEÑANZA MEDIA TÉCNICO PROFESIONAL y ARTISTICA JOVENES'
      WHEN 8 THEN 'ENSEÑANZA MEDIA TÉCNICO PROFESIONAL y ARTISTICA ADULTOS'
      ELSE 'N/A'
      END
      AS COD_ENSE2_GLOSA,
    COD_GRADO,

    CASE
      WHEN COD_ENSE=10 AND COD_GRADO=1 THEN 'SALA CUNA'
      WHEN COD_ENSE=10 AND COD_GRADO=2 THEN 'NIVEL MEDIO MENOR'
      WHEN COD_ENSE=10 AND COD_GRADO=3 THEN 'NIVEL MEDIO MAYOR'
      WHEN COD_ENSE=10 AND COD_GRADO=4 THEN 'PRIMER NIVEL DE TRANSICIÓN (PRE-KINDER)'
      WHEN COD_ENSE=10 AND COD_GRADO=5 THEN 'SEGUNDO NIVEL DE TRANSICIÓN (KINDER)'
      WHEN COD_ENSE=110 AND COD_GRADO=1 THEN '1O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=2 THEN '2O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=3 THEN '3O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=4 THEN '4O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=5 THEN '5O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=6 THEN '6O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=7 THEN '7O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=8 THEN '8O BÁSICO'
      WHEN COD_ENSE=165 AND COD_GRADO=1 THEN 'NIVEL BÁSICO 1 (1O A 4O BÁSICO)'
      WHEN COD_ENSE=165 AND COD_GRADO=2 THEN 'NIVEL BÁSICO 2 (5O A 6O BÁSICO)'
      WHEN COD_ENSE=165 AND COD_GRADO=3 THEN 'NIVEL BÁSICO 3 (7O A 8O BÁSICO)'
      WHEN COD_ENSE=167 AND COD_GRADO=2 THEN 'NIVEL BÁSICO 2 (5O A 6O BÁSICO)'
      WHEN COD_ENSE=167 AND COD_GRADO=3 THEN 'NIVEL BÁSICO 3 (7O A 8O BÁSICO)'
      WHEN COD_ENSE=211 AND COD_GRADO=1 THEN 'PREBÁSICO MATERNO 1O'
      WHEN COD_ENSE=211 AND COD_GRADO=2 THEN 'PREBÁSICO 1O - 1'
      WHEN COD_ENSE=211 AND COD_GRADO=3 THEN 'PREBÁSICO 1O - 2'
      WHEN COD_ENSE=211 AND COD_GRADO=4 THEN 'PREBÁSICO 1O - 3'
      WHEN COD_ENSE=211 AND COD_GRADO=5 THEN 'PREBÁSICO 2O - 4'
      WHEN COD_ENSE=211 AND COD_GRADO=6 THEN 'PREBÁSICO 2O - 5'
      WHEN COD_ENSE=211 AND COD_GRADO=7 THEN 'BÁSICO 1O - 1'
      WHEN COD_ENSE=211 AND COD_GRADO=8 THEN 'BÁSICO 1O - 2'
      WHEN COD_ENSE=211 AND COD_GRADO=9 THEN 'BÁSICO 1O - 3'
      WHEN COD_ENSE=211 AND COD_GRADO=10 THEN 'BÁSICO 1O - 4'
      WHEN COD_ENSE=211 AND COD_GRADO=11 THEN 'BÁSICO 2O - 5'
      WHEN COD_ENSE=211 AND COD_GRADO=12 THEN 'BÁSICO 2O - 6'
      WHEN COD_ENSE=211 AND COD_GRADO=13 THEN 'BÁSICO 2O - 7'
      WHEN COD_ENSE=211 AND COD_GRADO=14 THEN 'BÁSICO 2O - 8'
      WHEN COD_ENSE=211 AND COD_GRADO=15 THEN 'LABORAL 1'
      WHEN COD_ENSE=211 AND COD_GRADO=16 THEN 'LABORAL 2'
      WHEN COD_ENSE=211 AND COD_GRADO=17 THEN 'LABORAL 3'
      WHEN COD_ENSE=212 AND COD_GRADO=1 THEN 'PREBÁSICO 1O - 1'
      WHEN COD_ENSE=212 AND COD_GRADO=2 THEN 'PREBÁSICO 1O - 2'
      WHEN COD_ENSE=212 AND COD_GRADO=3 THEN 'PREBÁSICO 1O - 3'
      WHEN COD_ENSE=212 AND COD_GRADO=4 THEN 'PREBÁSICO 2O - 4'
      WHEN COD_ENSE=212 AND COD_GRADO=5 THEN 'BÁSICO 1O - 5'
      WHEN COD_ENSE=212 AND COD_GRADO=6 THEN 'BÁSICO 1O - 6'
      WHEN COD_ENSE=212 AND COD_GRADO=7 THEN 'BÁSICO 1O - 7'
      WHEN COD_ENSE=212 AND COD_GRADO=8 THEN 'BÁSICO 2O - 8'
      WHEN COD_ENSE=212 AND COD_GRADO=9 THEN 'BÁSICO 2O - 9'
      WHEN COD_ENSE=212 AND COD_GRADO=10 THEN 'BÁSICO 2O - 10'
      WHEN COD_ENSE=212 AND COD_GRADO=11 THEN 'LABORAL 1'
      WHEN COD_ENSE=212 AND COD_GRADO=12 THEN 'LABORAL 2'
      WHEN COD_ENSE=212 AND COD_GRADO=13 THEN 'LABORAL 3'
      WHEN COD_ENSE=212 AND COD_GRADO=14 THEN 'PREBÁSICO MATERNO 1° (ESTIMULACIÓN TEMPRANA)'
      WHEN COD_ENSE=213 AND COD_GRADO=1 THEN 'ESTIMULACIÓN TEMPRANA 1O - 1'
      WHEN COD_ENSE=213 AND COD_GRADO=2 THEN 'ESTIMULACIÓN TEMPRANA 1O - 2'
      WHEN COD_ENSE=213 AND COD_GRADO=3 THEN 'PREBÁSICO 1O - 1'
      WHEN COD_ENSE=213 AND COD_GRADO=4 THEN 'PREBÁSICO 1O - 2'
      WHEN COD_ENSE=213 AND COD_GRADO=5 THEN 'PREBÁSICO 2O - 3'
      WHEN COD_ENSE=213 AND COD_GRADO=6 THEN 'PREBÁSICO 2O - 4'
      WHEN COD_ENSE=213 AND COD_GRADO=7 THEN 'BÁSICO 1O - 1'
      WHEN COD_ENSE=213 AND COD_GRADO=8 THEN 'BÁSICO 1O - 2'
      WHEN COD_ENSE=213 AND COD_GRADO=9 THEN 'BÁSICO 1O - 3'
      WHEN COD_ENSE=213 AND COD_GRADO=10 THEN 'BÁSICO 1O - 4'
      WHEN COD_ENSE=213 AND COD_GRADO=11 THEN 'BÁSICO 2O - 5'
      WHEN COD_ENSE=213 AND COD_GRADO=12 THEN 'BÁSICO 2O - 6'
      WHEN COD_ENSE=213 AND COD_GRADO=13 THEN 'BÁSICO 2O - 7'
      WHEN COD_ENSE=213 AND COD_GRADO=14 THEN 'BÁSICO 2O - 8'
      WHEN COD_ENSE=213 AND COD_GRADO=15 THEN 'LABORAL 1O - 1'
      WHEN COD_ENSE=213 AND COD_GRADO=16 THEN 'LABORAL 1O - 2'
      WHEN COD_ENSE=213 AND COD_GRADO=17 THEN 'LABORAL 2O - 3'
      WHEN COD_ENSE=213 AND COD_GRADO=18 THEN 'LABORAL 2O - 4'
      WHEN COD_ENSE=214 AND COD_GRADO=1 THEN 'MEDIO MENOR'
      WHEN COD_ENSE=214 AND COD_GRADO=2 THEN 'MEDIO MAYOR'
      WHEN COD_ENSE=214 AND COD_GRADO=3 THEN 'PRIMER NIVEL DE TRANSICIÓN (PRE-KINDER)'
      WHEN COD_ENSE=214 AND COD_GRADO=4 THEN 'SEGUNDO NIVEL DE TRANSICIÓN (KINDER)'
      WHEN COD_ENSE=215 AND COD_GRADO=1 THEN 'ESTIMULACIÓN TEMPRANA 1O - 1'
      WHEN COD_ENSE=215 AND COD_GRADO=2 THEN 'ESTIMULACIÓN TEMPRANA 1O - 2'
      WHEN COD_ENSE=215 AND COD_GRADO=3 THEN 'PREBÁSICO 1O - 1'
      WHEN COD_ENSE=215 AND COD_GRADO=4 THEN 'PREBÁSICO 1O - 2'
      WHEN COD_ENSE=215 AND COD_GRADO=5 THEN 'PREBÁSICO 1O - 3'
      WHEN COD_ENSE=215 AND COD_GRADO=6 THEN 'PREBÁSICO 2O - 4'
      WHEN COD_ENSE=215 AND COD_GRADO=7 THEN 'PREBÁSICO 2O - 5'
      WHEN COD_ENSE=215 AND COD_GRADO=8 THEN 'BÁSICO 1O - 1'
      WHEN COD_ENSE=215 AND COD_GRADO=9 THEN 'BÁSICO 1O - 2'
      WHEN COD_ENSE=215 AND COD_GRADO=10 THEN 'BÁSICO 1O - 3'
      WHEN COD_ENSE=215 AND COD_GRADO=11 THEN 'BÁSICO 1O - 4'
      WHEN COD_ENSE=215 AND COD_GRADO=12 THEN 'BÁSICO 2O - 5'
      WHEN COD_ENSE=215 AND COD_GRADO=13 THEN 'BÁSICO 2O - 6'
      WHEN COD_ENSE=215 AND COD_GRADO=14 THEN 'BÁSICO 2O - 7'
      WHEN COD_ENSE=215 AND COD_GRADO=15 THEN 'BÁSICO 2O - 8'
      WHEN COD_ENSE=215 AND COD_GRADO=16 THEN 'LABORAL 1O - 1'
      WHEN COD_ENSE=212 AND COD_GRADO=17 THEN 'LABORAL 1O - 2'
      WHEN COD_ENSE=212 AND COD_GRADO=18 THEN 'LABORAL 2O - 3'
      WHEN COD_ENSE=212 AND COD_GRADO=19 THEN 'LABORAL 2O - 4'
      WHEN COD_ENSE=212 AND COD_GRADO=5 THEN 'BÁSICO 1° - 5'
      WHEN COD_ENSE=212 AND COD_GRADO=6 THEN 'BÁSICO 1° - 6'
      WHEN COD_ENSE=212 AND COD_GRADO=7 THEN 'BÁSICO 1° - 7'
      WHEN COD_ENSE=212 AND COD_GRADO=8 THEN 'BÁSICO 2° - 8'
      WHEN COD_ENSE=213 AND COD_GRADO=9 THEN 'BÁSICO 2° - 9'
      WHEN COD_ENSE=213 AND COD_GRADO=10 THEN 'BÁSICO 2° - 10'
      WHEN COD_ENSE=213 AND COD_GRADO=11 THEN 'LABORAL 1'
      WHEN COD_ENSE=213 AND COD_GRADO=12 THEN 'LABORAL 2'
      WHEN COD_ENSE=213 AND COD_GRADO=13 THEN 'LABORAL 314 PREBÁSICO MATERNO 1° (ESTIMULACIÓN TEMPRANA)'
      WHEN COD_ENSE=213 AND COD_GRADO=15 THEN 'PREBÁSICO 1° - 1'
      WHEN COD_ENSE=213 AND COD_GRADO=16 THEN 'PREBÁSICO 1° - 2'
      WHEN COD_ENSE=213 AND COD_GRADO=17 THEN 'PREBÁSICO 2° - 3'
      WHEN COD_ENSE=213 AND COD_GRADO=18 THEN 'PREBÁSICO 2° - 4'
      WHEN COD_ENSE=213 AND COD_GRADO=1 THEN 'PREBÁSICO 1O - 1'
      WHEN COD_ENSE=213 AND COD_GRADO=2 THEN 'PREBÁSICO 1O - 2'
      WHEN COD_ENSE=213 AND COD_GRADO=3 THEN 'PREBÁSICO 2O - 3'
      WHEN COD_ENSE=213 AND COD_GRADO=4 THEN 'PREBÁSICO 2O - 4'
      WHEN COD_ENSE=213 AND COD_GRADO=5 THEN 'BÁSICO 1O - 5'
      WHEN COD_ENSE=213 AND COD_GRADO=6 THEN 'BÁSICO 1O - 6'
      WHEN COD_ENSE=213 AND COD_GRADO=7 THEN 'BÁSICO 1O - 7'
      WHEN COD_ENSE=213 AND COD_GRADO=8 THEN 'BÁSICO 2O - 8'
      WHEN COD_ENSE=213 AND COD_GRADO=9 THEN 'BÁSICO 2O - 9'
      WHEN COD_ENSE=214 AND COD_GRADO=10 THEN 'BÁSICO 2O - 10'
      WHEN COD_ENSE=214 AND COD_GRADO=11 THEN 'LABORAL 1'
      WHEN COD_ENSE=214 AND COD_GRADO=12 THEN 'LABORAL 2'
      WHEN COD_ENSE=214 AND COD_GRADO=13 THEN 'LABORAL 3'
      WHEN COD_ENSE=215 AND COD_GRADO=14 THEN 'PREBÁSICO MATERNO 1O (ESTIMULACIÓN TEMPRANA)'
      WHEN COD_ENSE=215 AND COD_GRADO=1 THEN 'PREBÁSICO 1'
      WHEN COD_ENSE=215 AND COD_GRADO=2 THEN 'PREBÁSICO 2'
      WHEN COD_ENSE=215 AND COD_GRADO=3 THEN 'PREBÁSICO 3'
      WHEN COD_ENSE=215 AND COD_GRADO=4 THEN 'PREBÁSICO 4'
      WHEN COD_ENSE=215 AND COD_GRADO=5 THEN 'PREBÁSICO 5'
      WHEN COD_ENSE=215 AND COD_GRADO=6 THEN 'BÁSICO 1'
      WHEN COD_ENSE=215 AND COD_GRADO=7 THEN 'BÁSICO 2'
      WHEN COD_ENSE=215 AND COD_GRADO=8 THEN 'BÁSICO 3'
      WHEN COD_ENSE=215 AND COD_GRADO=9 THEN 'BÁSICO 4'
      WHEN COD_ENSE=215 AND COD_GRADO=10 THEN 'BÁSICO 5'
      WHEN COD_ENSE=215 AND COD_GRADO=11 THEN 'BÁSICO 6'
      WHEN COD_ENSE=215 AND COD_GRADO=12 THEN 'BÁSICO 7'
      WHEN COD_ENSE=215 AND COD_GRADO=13 THEN 'BÁSICO 8'
      WHEN COD_ENSE=215 AND COD_GRADO=14 THEN 'BÁSICO 9'
      WHEN COD_ENSE=215 AND COD_GRADO=15 THEN 'BÁSICO 10'
      WHEN COD_ENSE=299 AND COD_GRADO=16 THEN 'LABORAL 1'
      WHEN COD_ENSE=299 AND COD_GRADO=17 THEN 'LABORAL 2'
      WHEN COD_ENSE=299 AND COD_GRADO=18 THEN 'LABORAL 3'
      WHEN COD_ENSE=299 AND COD_GRADO=19 THEN 'LABORAL 4'
      WHEN COD_ENSE=310 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=310 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=310 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=310 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=363 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=363 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O Y 4O MEDIO)'
      WHEN COD_ENSE=410 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=410 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=410 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=410 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=463 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=463 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O MEDIO)'
      WHEN COD_ENSE=463 AND COD_GRADO=4 THEN 'TERCERO NIVEL (4O MEDIO)'
      WHEN COD_ENSE=510 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=510 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=510 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=510 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=563 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=563 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O MEDIO)'
      WHEN COD_ENSE=563 AND COD_GRADO=4 THEN 'TERCERO NIVEL (4O MEDIO)'
      WHEN COD_ENSE=610 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=610 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=610 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=610 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=663 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=663 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O MEDIO)'
      WHEN COD_ENSE=663 AND COD_GRADO=4 THEN 'TERCERO NIVEL (4O MEDIO)'
      WHEN COD_ENSE=710 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=710 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=710 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=710 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=763 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=763 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O MEDIO)'
      WHEN COD_ENSE=763 AND COD_GRADO=4 THEN 'TERCERO NIVEL (4O MEDIO)'
      WHEN COD_ENSE=810 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=810 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=810 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=810 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=863 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=863 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O MEDIO)'
      WHEN COD_ENSE=863 AND COD_GRADO=4 THEN 'TERCERO NIVEL (4O MEDIO)'
      WHEN COD_ENSE=910 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=910 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=910 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=910 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=963 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=963 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O MEDIO)'
      WHEN COD_ENSE=963 AND COD_GRADO=4 THEN 'TERCERO NIVEL (4O MEDIO)'
      ELSE 'N/A'
      END
      AS COD_GRADO_GLOSA,

    LET_CUR,
    MRUN,
    GEN_ALU,
    CASE GEN_ALU
      WHEN 0 THEN 'SIN INFORMACION'
      WHEN 1 THEN 'EDUCACION PARVULARIA'
      WHEN 2 THEN 'ENSEÑANZA BASICA NIÑOS'
      ELSE 'N/A'
      END
      AS GEN_ALU_GLOSA,
    CASE FEC_NAC_ALU
      WHEN '190001' THEN 'SIN INFORMACION'
      WHEN '180001' THEN 'SIN INFORMACION'
      ELSE FEC_NAC_ALU
      END
      AS FEC_NAC_ALU,
    COD_COM_ALU,
    NOM_COM_ALU,
    DIAS_ASISTIDOS,
    DIAS_TRABAJADOS,
    ASIS_PROMEDIO,
    LAT_COMUNA, 
    LONG_COMUNA,
    TIPO_REGION,
    LAT_REGION,
    LONG_REGION
  FROM
    `infinite-lens-352300.data_chile.asistencia` 
  WHERE 
    MES_ESCOLAR IS NOT NULL
  AND (
    AGNO IS NOT NULL OR
    MES_ESCOLAR IS NOT NULL OR
    RBD IS NOT NULL OR
    DGV_RBD IS NOT NULL OR
    NOM_RBD IS NOT NULL OR
    NOM_RBD != '' OR 
    COD_REG_RBD IS NOT NULL OR
    COD_REG_RBD != 0 OR
    NOM_REG_RBD_A IS NOT NULL OR
    COD_PRO_RBD IS NOT NULL OR
    COD_COM_RBD IS NOT NULL OR
    NOM_COM_RBD IS NOT NULL OR
    COD_DEPROV_RBD IS NOT NULL OR
    NOM_DEPROV_RBD IS NOT NULL OR
    RURAL_RBD IS NOT NULL OR
    COD_DEPE IS NOT NULL OR
    COD_DEPE2 IS NOT NULL OR
    COD_ENSE IS NOT NULL OR
    COD_ENSE2 IS NOT NULL OR
    COD_GRADO IS NOT NULL OR
    LET_CUR IS NOT NULL OR
    MRUN IS NOT NULL OR
    GEN_ALU IS NOT NULL OR
    FEC_NAC_ALU IS NOT NULL OR
    COD_COM_ALU IS NOT NULL OR
    NOM_COM_ALU IS NOT NULL OR
    DIAS_ASISTIDOS IS NOT NULL OR
    DIAS_TRABAJADOS IS NOT NULL OR
    ASIS_PROMEDIO IS NOT NULL
  )
);
```

``` bigquery
CREATE OR REPLACE VIEW `infinite-lens-352300.data_chile.v_asistencia_comuna` (
  COMUNA, 
  LATITUD_COMUNA,
  LONGITUD_COMUNA,
  PROMEDIO_ASISTENCIA,
  DESV_STD_ASISTENCIA,
  COUNT_ASISTENCIA,
  TIPO_REGION)
   AS 
(
SELECT
    NOM_COM_RBD AS COMUNA,
    LAT_COMUNA AS LATITUD_COMUNA,
    LONG_COMUNA AS LONGITUD_COMUNA,
    AVG(ASIS_PROMEDIO) AS PROMEDIO_ASISTENCIA,
    STDDEV(ASIS_PROMEDIO) AS DESV_STD_ASISTENCIA,
    COUNT(ASIS_PROMEDIO) AS COUNT_ASISTENCIA,
    TIPO_REGION
  FROM
    `infinite-lens-352300.data_chile.v_asistencia` 
  GROUP BY
    NOM_COM_RBD,
    LAT_COMUNA,
    LONG_COMUNA,
    TIPO_REGION
);
```

``` bigquery
CREATE OR REPLACE VIEW `infinite-lens-352300.data_chile.v_asistencia_region_anio` (
  REGION, 
  REGION_NOMBRE,
  LATITUD_REGION,
  LONGITUD_REGION,
  PROMEDIO_ASISTENCIA,
  DESV_STD_ASISTENCIA,
  COUNT_ASISTENCIA,
  TIPO_REGION,
  AGNO)
   AS 
(
SELECT
    COD_REG_RBD AS REGION,
    NOM_REG_RBD_A AS REGION_NOMBRE,
    LAT_REGION AS LATITUD_REGION,
    LONG_REGION AS LONGITUD_REGION,
    AVG(ASIS_PROMEDIO) AS PROMEDIO_ASISTENCIA,
    STDDEV(ASIS_PROMEDIO) AS DESV_STD_ASISTENCIA,
    COUNT(ASIS_PROMEDIO) AS COUNT_ASISTENCIA,
    TIPO_REGION,
    AGNO
  FROM
    `infinite-lens-352300.data_chile.v_asistencia` 
  GROUP BY
    COD_REG_RBD,
    REGION_NOMBRE,
    LAT_REGION,
    LONG_REGION,
    TIPO_REGION,
    AGNO
)
```

``` bigquery
CREATE OR REPLACE VIEW `infinite-lens-352300.data_chile.v_asistencia_region_mes_anio` (
  REGION, 
  REGION_NOMBRE,
  LATITUD_REGION,
  LONGITUD_REGION,
  PROMEDIO_ASISTENCIA,
  DESV_STD_ASISTENCIA,
  COUNT_ASISTENCIA,
  TIPO_REGION,
  AGNO,
  MES_ESCOLAR)
   AS 
(
SELECT
    COD_REG_RBD AS REGION,
    NOM_REG_RBD_A AS REGION_NOMBRE,
    LAT_REGION AS LATITUD_REGION,
    LONG_REGION AS LONGITUD_REGION,
    AVG(ASIS_PROMEDIO) AS PROMEDIO_ASISTENCIA,
    STDDEV(ASIS_PROMEDIO) AS DESV_STD_ASISTENCIA,
    COUNT(ASIS_PROMEDIO) AS COUNT_ASISTENCIA,
    TIPO_REGION,
    AGNO,
    MES_ESCOLAR
  FROM
    `infinite-lens-352300.data_chile.v_asistencia` 
  GROUP BY
    COD_REG_RBD,
    REGION_NOMBRE,
    LAT_REGION,
    LONG_REGION,
    TIPO_REGION,
    AGNO,
    MES_ESCOLAR
)
```

