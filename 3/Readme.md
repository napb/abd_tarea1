1- ejecuta para limpiar la asistencia
``` bigquery
UPDATE `infinite-lens-352300.data_chile.asistencia` SET
  ASIS_PROMEDIO = ((DIAS_ASISTIDOS * 100) / DIAS_TRABAJADOS)
WHERE 
  MES_ESCOLAR IS NOT NULL
AND 
  DIAS_TRABAJADOS != 0;
```

2-  ejecuta en BQ para añadir nuevas columnas LAT, LONG
``` bigquery
ALTER TABLE `infinite-lens-352300.data_chile.asistencia` ADD COLUMN LAT_COMUNA STRING;
ALTER TABLE `infinite-lens-352300.data_chile.asistencia` ADD COLUMN LONG_COMUNA STRING;
```
2.1- ejecuta para limpiar la tabla info_comunas

``` bigquery
update `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE =   "CALERA" WHERE UPPER(NOMBRE)  =   "LA CALERA";
update `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE =   "MAULLIN" WHERE UPPER(NOMBRE)  =   "MAULLIN";
update `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE =   "TREHUACO" WHERE UPPER(NOMBRE)  =   "TREGUACO";
update `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE =   "PAIGUANO" WHERE UPPER(NOMBRE)  =   "PAIHUANO";
update `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE =   "VICHUQUEN" WHERE UPPER(NOMBRE)  =   "VICHUQUEN";
update `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE =   "LLAILLAY" WHERE UPPER(NOMBRE)  =   "LLAY-LLAY";
update `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE =   "TILTIL" WHERE UPPER(NOMBRE)  =   "TIL TIL";
update `infinite-lens-352300.data_chile.info_comunas` SET NOMBRE =   "RANQUIL" WHERE UPPER(NOMBRE)  =   "RANQUIL";
```

3- ejecuta en BQ para modificar tabla asistencia la latitud y longitud
``` bigquery
UPDATE `infinite-lens-352300.data_chile.asistencia` a SET
  a.LAT_COMUNA = b.LATTITUD,
  a.LONG_COMUNA = b.LONGITUD
FROM 
  `infinite-lens-352300.data_chile.info_comunas` b
WHERE 
  a.NOM_COM_RBD = UPPER(b.NOMBRE)
AND 
  a.MES_ESCOLAR IS NOT NULL
```
deben ser 345 registros (con todas las comunas)
``` bigquery
SELECT
    NOM_COM_RBD,
    LAT_COMUNA,
    LONG_COMUNA  
FROM 
  `infinite-lens-352300.data_chile.asistencia`
WHERE 
  MES_ESCOLAR IS NOT NULL
GROUP BY
  NOM_COM_RBD,
  LAT_COMUNA,
  LONG_COMUNA
```

4- DDL vista asistencia con data limpia
``` bigquery

CREATE OR REPLACE VIEW data_chile.v_asistencia(
    AGNO,
    MES_ESCOLAR,
    RBD,
    DGV_RBD,
    NOM_RBD,
    COD_REG_RBD,
    NOM_REG_RBD_A,
    COD_PRO_RBD,
    COD_COM_RBD,
    NOM_COM_RBD,
    COD_DEPROV_RBD,
    NOM_DEPROV_RBD,
    RURAL_RBD,
    RURAL_RBD_GLOSA,
    COD_DEPE,
    COD_DEPE_GLOSA,
    COD_DEPE2,
    COD_DEPE2_GLOSA,
    COD_ENSE,
    COD_ENSE_GLOSA,
    COD_ENSE2,
    COD_ENSE2_GLOSA,
    COD_GRADO,
    COD_GRADO_GLOSA,
    LET_CUR,
    MRUN,
    GEN_ALU,
    GEN_ALU_GLOSA,
    FEC_NAC_ALU,
    COD_COM_ALU,
    NOM_COM_ALU,
    DIAS_ASISTIDOS,
    DIAS_TRABAJADOS,
    ASIS_PROMEDIO,
    LAT_COMUNA, 
    LONG_COMUNA
) AS (
SELECT
    AGNO,
    MES_ESCOLAR,
    RBD,
    DGV_RBD,
    NOM_RBD,
    COD_REG_RBD,
    CASE NOM_REG_RBD_A
      WHEN 'ARAUC' THEN 'ARAUCANIA'
      WHEN 'ATCMA' THEN 'ATACAMA'
      WHEN 'COQ' THEN 'COQUIMBO'
      WHEN 'RM' THEN 'REGION METROPOLITANA'
      WHEN 'LAGOS' THEN 'LOS LAGOS'
      WHEN 'AYSEN' THEN 'AYSEN'
      WHEN 'NUBLE' THEN 'ÑUBLE'
      WHEN 'AYP' THEN 'ARICA Y PARINACOTA'
      WHEN 'TPCA' THEN 'TARAPACA'
      WHEN 'BBIO' THEN 'BIO-BIO'
      WHEN 'VALPO' THEN 'VALPARAISO'
      WHEN 'RIOS' THEN 'LOS RIOS'
      WHEN 'MAG' THEN 'MAGALLANES'
      WHEN 'LGBO' THEN 'LIB. BDO. OHIGGINS'
      WHEN 'ANTOF' THEN 'ANTOFAGASTA'
      ELSE 'N/A'
      END
      AS NOM_REG_RBD_A,
    COD_PRO_RBD,
    COD_COM_RBD,
    NOM_COM_RBD,
    COD_DEPROV_RBD,
    NOM_DEPROV_RBD,

    RURAL_RBD,
    CASE RURAL_RBD
      WHEN 0 THEN 'URBANA'
      WHEN 1 THEN 'RURAL'
      ELSE 'N/A'
      END
      AS RURAL_RBD_GLOSA,

    COD_DEPE,
    CASE COD_DEPE
      WHEN 1 THEN 'CORPORACION MUNICIPAL'
      WHEN 2 THEN 'MUNICIPAL DAEM'
      WHEN 3 THEN 'PARTICULAR SUVENCIONADO'
      WHEN 4 THEN 'PARTICULAR PAGADO'
      WHEN 5 THEN 'CORPORACION DE ADMINISTRACION DELEGADA'
      WHEN 6 THEN 'SERVICIO LOCAL DE EDUCACION'
      ELSE 'N/A'
      END
      AS COD_DEPE_GLOSA,

    COD_DEPE2,
    CASE COD_DEPE2
      WHEN '1' THEN 'CORPORACION MUNICIPAL'
      WHEN '2' THEN 'MUNICIPAL DAEM'
      WHEN '3' THEN 'PARTICULAR SUVENCIONADO'
      WHEN '4' THEN 'PARTICULAR PAGADO'
      WHEN '5' THEN 'CORPORACION DE ADMINISTRACION DELEGADA'
      WHEN '6' THEN 'SERVICIO LOCAL DE EDUCACION'
      ELSE 'N/A'
      END
      AS COD_DEPE2_GLOSA,
    COD_ENSE,
    CASE COD_ENSE 
      WHEN 10 THEN 'EDUCACIÓN PARVULARIA'
      WHEN 110 THEN 'ENSEÑANZA BÁSICA'
      WHEN 165 THEN 'EDUCACIÓN DE ADULTOS SIN OFICIOS(DECRETO 584/2007)'
      WHEN 167 THEN 'EDUCACIÓN DE ADULTOS CON OFICIOS(DECRETO 584/2007Y999/2009)'
      WHEN 211 THEN 'EDUCACIÓN ESPECIAL DISCAPACID ADAUDITIVA'
      WHEN 212 THEN 'EDUCACIÓN ESPECIAL DISCAPACIDAD INTELECTUAL'
      WHEN 213 THEN 'EDUCACIÓN ESPECIAL DISCAPACIDAD VISUAL'
      WHEN 214 THEN 'EDUCACIÓN ESPECIAL TRASTORNOS ESPECÍFICOS DEL LENGUAJE'
      WHEN 215 THEN 'EDUCACIÓN ESPECIAL TRASTORNOS MOTORES'
      WHEN 216 THEN 'EDUCACIÓN ESPECIAL AUTISMO'
      WHEN 217 THEN 'EDUCACIÓN ESPECIAL DISCAPACIDAD GRAVES ALTERACIONES EN LA CAPACIDAD DE RELACIÓN Y COMUNICACIÓN'
      WHEN 218 THEN 'EDUCACIÓN ESPECIAL DISCAPACIDAD MÚLTIPLE'
      WHEN 219 THEN 'EDUCACIÓN ESPECIAL SORDO CEGUERA'
      WHEN 299 THEN 'OPCIÓN 4 PROGRAMA INTEGRACIÓN ESCOLAR'
      WHEN 310 THEN 'ENSEÑANZA MEDIA H-C NIÑOS Y JÓVENES'
      WHEN 363 THEN 'EDUCACIÓN MEDIAH-CADULTOS(DECRETON°1000/2009)'
      WHEN 410 THEN 'ENSEÑANZA MEDIA TÉCNICO –PROFESIONAL COMERCIAL NIÑOS'
      WHEN 463 THEN 'EDUCACIÓN MEDIA T-P COMERCIAL ADULTOS (DECRETO N° 1000/2009) 510 ENSEÑANZA MEDIA T-P INDUSTRIAL NIÑOS'
      WHEN 563 THEN 'EDUCACIÓN MEDIA T-P INDUSTRIAL ADULTOS (DECRETO N° 1000/2009) 610 ENSEÑANZA MEDIA T-P TÉCNICA NIÑOS'
      WHEN 663 THEN 'EDUCACIÓN MEDIA T-P TÉCNICA ADULTOS (DECRETO N° 1000/2009) 710 ENSEÑANZA MEDIA T-P AGRÍCOLA NIÑOS'
      WHEN 763 THEN 'EDUCACIÓN MEDIA T-P AGRÍCOLA ADULTOS (DECRETO N° 1000/2009) 810 ENSEÑANZA MEDIA T-P MARÍTIMA NIÑOS'
      WHEN 863 THEN 'ENSEÑANZA MEDIA T-P MARÍTIMA ADULTOS (DECRETO N° 1000/2009) 910 ENSEÑANZA MEDIA ARTÍSTICAN IÑOS Y JÓVENES'
      ELSE 'N/A'
      END
      AS COD_ENSE_GLOSA,
    COD_ENSE2,
    CASE COD_ENSE2
      WHEN 1 THEN 'EDUCACIÓN PARVULARIA'
      WHEN 2 THEN 'ENSEÑANZA BASICA NIÑOS'
      WHEN 3 THEN 'ENSEÑANZA BASICA ADULTOS'
      WHEN 4 THEN 'EDUCACIÓN ESPECIAL'
      WHEN 5 THEN 'ENSEÑANZA MEDIA HUMANISTICO CIENTIFICA JOVENES'
      WHEN 6 THEN 'ENSEÑANZA MEDIA HUMANISTICO CIENTIFICA ADULTOS'
      WHEN 7 THEN 'ENSEÑANZA MEDIA TÉCNICO PROFESIONAL y ARTISTICA JOVENES'
      WHEN 8 THEN 'ENSEÑANZA MEDIA TÉCNICO PROFESIONAL y ARTISTICA ADULTOS'
      ELSE 'N/A'
      END
      AS COD_ENSE2_GLOSA,
    COD_GRADO,

    CASE
      WHEN COD_ENSE=10 AND COD_GRADO=1 THEN 'SALA CUNA'
      WHEN COD_ENSE=10 AND COD_GRADO=2 THEN 'NIVEL MEDIO MENOR'
      WHEN COD_ENSE=10 AND COD_GRADO=3 THEN 'NIVEL MEDIO MAYOR'
      WHEN COD_ENSE=10 AND COD_GRADO=4 THEN 'PRIMER NIVEL DE TRANSICIÓN (PRE-KINDER)'
      WHEN COD_ENSE=10 AND COD_GRADO=5 THEN 'SEGUNDO NIVEL DE TRANSICIÓN (KINDER)'
      WHEN COD_ENSE=110 AND COD_GRADO=1 THEN '1O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=2 THEN '2O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=3 THEN '3O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=4 THEN '4O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=5 THEN '5O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=6 THEN '6O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=7 THEN '7O BÁSICO'
      WHEN COD_ENSE=110 AND COD_GRADO=8 THEN '8O BÁSICO'
      WHEN COD_ENSE=165 AND COD_GRADO=1 THEN 'NIVEL BÁSICO 1 (1O A 4O BÁSICO)'
      WHEN COD_ENSE=165 AND COD_GRADO=2 THEN 'NIVEL BÁSICO 2 (5O A 6O BÁSICO)'
      WHEN COD_ENSE=165 AND COD_GRADO=3 THEN 'NIVEL BÁSICO 3 (7O A 8O BÁSICO)'
      WHEN COD_ENSE=167 AND COD_GRADO=2 THEN 'NIVEL BÁSICO 2 (5O A 6O BÁSICO)'
      WHEN COD_ENSE=167 AND COD_GRADO=3 THEN 'NIVEL BÁSICO 3 (7O A 8O BÁSICO)'
      WHEN COD_ENSE=211 AND COD_GRADO=1 THEN 'PREBÁSICO MATERNO 1O'
      WHEN COD_ENSE=211 AND COD_GRADO=2 THEN 'PREBÁSICO 1O - 1'
      WHEN COD_ENSE=211 AND COD_GRADO=3 THEN 'PREBÁSICO 1O - 2'
      WHEN COD_ENSE=211 AND COD_GRADO=4 THEN 'PREBÁSICO 1O - 3'
      WHEN COD_ENSE=211 AND COD_GRADO=5 THEN 'PREBÁSICO 2O - 4'
      WHEN COD_ENSE=211 AND COD_GRADO=6 THEN 'PREBÁSICO 2O - 5'
      WHEN COD_ENSE=211 AND COD_GRADO=7 THEN 'BÁSICO 1O - 1'
      WHEN COD_ENSE=211 AND COD_GRADO=8 THEN 'BÁSICO 1O - 2'
      WHEN COD_ENSE=211 AND COD_GRADO=9 THEN 'BÁSICO 1O - 3'
      WHEN COD_ENSE=211 AND COD_GRADO=10 THEN 'BÁSICO 1O - 4'
      WHEN COD_ENSE=211 AND COD_GRADO=11 THEN 'BÁSICO 2O - 5'
      WHEN COD_ENSE=211 AND COD_GRADO=12 THEN 'BÁSICO 2O - 6'
      WHEN COD_ENSE=211 AND COD_GRADO=13 THEN 'BÁSICO 2O - 7'
      WHEN COD_ENSE=211 AND COD_GRADO=14 THEN 'BÁSICO 2O - 8'
      WHEN COD_ENSE=211 AND COD_GRADO=15 THEN 'LABORAL 1'
      WHEN COD_ENSE=211 AND COD_GRADO=16 THEN 'LABORAL 2'
      WHEN COD_ENSE=211 AND COD_GRADO=17 THEN 'LABORAL 3'
      WHEN COD_ENSE=212 AND COD_GRADO=1 THEN 'PREBÁSICO 1O - 1'
      WHEN COD_ENSE=212 AND COD_GRADO=2 THEN 'PREBÁSICO 1O - 2'
      WHEN COD_ENSE=212 AND COD_GRADO=3 THEN 'PREBÁSICO 1O - 3'
      WHEN COD_ENSE=212 AND COD_GRADO=4 THEN 'PREBÁSICO 2O - 4'
      WHEN COD_ENSE=212 AND COD_GRADO=5 THEN 'BÁSICO 1O - 5'
      WHEN COD_ENSE=212 AND COD_GRADO=6 THEN 'BÁSICO 1O - 6'
      WHEN COD_ENSE=212 AND COD_GRADO=7 THEN 'BÁSICO 1O - 7'
      WHEN COD_ENSE=212 AND COD_GRADO=8 THEN 'BÁSICO 2O - 8'
      WHEN COD_ENSE=212 AND COD_GRADO=9 THEN 'BÁSICO 2O - 9'
      WHEN COD_ENSE=212 AND COD_GRADO=10 THEN 'BÁSICO 2O - 10'
      WHEN COD_ENSE=212 AND COD_GRADO=11 THEN 'LABORAL 1'
      WHEN COD_ENSE=212 AND COD_GRADO=12 THEN 'LABORAL 2'
      WHEN COD_ENSE=212 AND COD_GRADO=13 THEN 'LABORAL 3'
      WHEN COD_ENSE=212 AND COD_GRADO=14 THEN 'PREBÁSICO MATERNO 1° (ESTIMULACIÓN TEMPRANA)'
      WHEN COD_ENSE=213 AND COD_GRADO=1 THEN 'ESTIMULACIÓN TEMPRANA 1O - 1'
      WHEN COD_ENSE=213 AND COD_GRADO=2 THEN 'ESTIMULACIÓN TEMPRANA 1O - 2'
      WHEN COD_ENSE=213 AND COD_GRADO=3 THEN 'PREBÁSICO 1O - 1'
      WHEN COD_ENSE=213 AND COD_GRADO=4 THEN 'PREBÁSICO 1O - 2'
      WHEN COD_ENSE=213 AND COD_GRADO=5 THEN 'PREBÁSICO 2O - 3'
      WHEN COD_ENSE=213 AND COD_GRADO=6 THEN 'PREBÁSICO 2O - 4'
      WHEN COD_ENSE=213 AND COD_GRADO=7 THEN 'BÁSICO 1O - 1'
      WHEN COD_ENSE=213 AND COD_GRADO=8 THEN 'BÁSICO 1O - 2'
      WHEN COD_ENSE=213 AND COD_GRADO=9 THEN 'BÁSICO 1O - 3'
      WHEN COD_ENSE=213 AND COD_GRADO=10 THEN 'BÁSICO 1O - 4'
      WHEN COD_ENSE=213 AND COD_GRADO=11 THEN 'BÁSICO 2O - 5'
      WHEN COD_ENSE=213 AND COD_GRADO=12 THEN 'BÁSICO 2O - 6'
      WHEN COD_ENSE=213 AND COD_GRADO=13 THEN 'BÁSICO 2O - 7'
      WHEN COD_ENSE=213 AND COD_GRADO=14 THEN 'BÁSICO 2O - 8'
      WHEN COD_ENSE=213 AND COD_GRADO=15 THEN 'LABORAL 1O - 1'
      WHEN COD_ENSE=213 AND COD_GRADO=16 THEN 'LABORAL 1O - 2'
      WHEN COD_ENSE=213 AND COD_GRADO=17 THEN 'LABORAL 2O - 3'
      WHEN COD_ENSE=213 AND COD_GRADO=18 THEN 'LABORAL 2O - 4'
      WHEN COD_ENSE=214 AND COD_GRADO=1 THEN 'MEDIO MENOR'
      WHEN COD_ENSE=214 AND COD_GRADO=2 THEN 'MEDIO MAYOR'
      WHEN COD_ENSE=214 AND COD_GRADO=3 THEN 'PRIMER NIVEL DE TRANSICIÓN (PRE-KINDER)'
      WHEN COD_ENSE=214 AND COD_GRADO=4 THEN 'SEGUNDO NIVEL DE TRANSICIÓN (KINDER)'
      WHEN COD_ENSE=215 AND COD_GRADO=1 THEN 'ESTIMULACIÓN TEMPRANA 1O - 1'
      WHEN COD_ENSE=215 AND COD_GRADO=2 THEN 'ESTIMULACIÓN TEMPRANA 1O - 2'
      WHEN COD_ENSE=215 AND COD_GRADO=3 THEN 'PREBÁSICO 1O - 1'
      WHEN COD_ENSE=215 AND COD_GRADO=4 THEN 'PREBÁSICO 1O - 2'
      WHEN COD_ENSE=215 AND COD_GRADO=5 THEN 'PREBÁSICO 1O - 3'
      WHEN COD_ENSE=215 AND COD_GRADO=6 THEN 'PREBÁSICO 2O - 4'
      WHEN COD_ENSE=215 AND COD_GRADO=7 THEN 'PREBÁSICO 2O - 5'
      WHEN COD_ENSE=215 AND COD_GRADO=8 THEN 'BÁSICO 1O - 1'
      WHEN COD_ENSE=215 AND COD_GRADO=9 THEN 'BÁSICO 1O - 2'
      WHEN COD_ENSE=215 AND COD_GRADO=10 THEN 'BÁSICO 1O - 3'
      WHEN COD_ENSE=215 AND COD_GRADO=11 THEN 'BÁSICO 1O - 4'
      WHEN COD_ENSE=215 AND COD_GRADO=12 THEN 'BÁSICO 2O - 5'
      WHEN COD_ENSE=215 AND COD_GRADO=13 THEN 'BÁSICO 2O - 6'
      WHEN COD_ENSE=215 AND COD_GRADO=14 THEN 'BÁSICO 2O - 7'
      WHEN COD_ENSE=215 AND COD_GRADO=15 THEN 'BÁSICO 2O - 8'
      WHEN COD_ENSE=215 AND COD_GRADO=16 THEN 'LABORAL 1O - 1'
      WHEN COD_ENSE=212 AND COD_GRADO=17 THEN 'LABORAL 1O - 2'
      WHEN COD_ENSE=212 AND COD_GRADO=18 THEN 'LABORAL 2O - 3'
      WHEN COD_ENSE=212 AND COD_GRADO=19 THEN 'LABORAL 2O - 4'
      WHEN COD_ENSE=212 AND COD_GRADO=5 THEN 'BÁSICO 1° - 5'
      WHEN COD_ENSE=212 AND COD_GRADO=6 THEN 'BÁSICO 1° - 6'
      WHEN COD_ENSE=212 AND COD_GRADO=7 THEN 'BÁSICO 1° - 7'
      WHEN COD_ENSE=212 AND COD_GRADO=8 THEN 'BÁSICO 2° - 8'
      WHEN COD_ENSE=213 AND COD_GRADO=9 THEN 'BÁSICO 2° - 9'
      WHEN COD_ENSE=213 AND COD_GRADO=10 THEN 'BÁSICO 2° - 10'
      WHEN COD_ENSE=213 AND COD_GRADO=11 THEN 'LABORAL 1'
      WHEN COD_ENSE=213 AND COD_GRADO=12 THEN 'LABORAL 2'
      WHEN COD_ENSE=213 AND COD_GRADO=13 THEN 'LABORAL 314 PREBÁSICO MATERNO 1° (ESTIMULACIÓN TEMPRANA)'
      WHEN COD_ENSE=213 AND COD_GRADO=15 THEN 'PREBÁSICO 1° - 1'
      WHEN COD_ENSE=213 AND COD_GRADO=16 THEN 'PREBÁSICO 1° - 2'
      WHEN COD_ENSE=213 AND COD_GRADO=17 THEN 'PREBÁSICO 2° - 3'
      WHEN COD_ENSE=213 AND COD_GRADO=18 THEN 'PREBÁSICO 2° - 4'
      WHEN COD_ENSE=213 AND COD_GRADO=1 THEN 'PREBÁSICO 1O - 1'
      WHEN COD_ENSE=213 AND COD_GRADO=2 THEN 'PREBÁSICO 1O - 2'
      WHEN COD_ENSE=213 AND COD_GRADO=3 THEN 'PREBÁSICO 2O - 3'
      WHEN COD_ENSE=213 AND COD_GRADO=4 THEN 'PREBÁSICO 2O - 4'
      WHEN COD_ENSE=213 AND COD_GRADO=5 THEN 'BÁSICO 1O - 5'
      WHEN COD_ENSE=213 AND COD_GRADO=6 THEN 'BÁSICO 1O - 6'
      WHEN COD_ENSE=213 AND COD_GRADO=7 THEN 'BÁSICO 1O - 7'
      WHEN COD_ENSE=213 AND COD_GRADO=8 THEN 'BÁSICO 2O - 8'
      WHEN COD_ENSE=213 AND COD_GRADO=9 THEN 'BÁSICO 2O - 9'
      WHEN COD_ENSE=214 AND COD_GRADO=10 THEN 'BÁSICO 2O - 10'
      WHEN COD_ENSE=214 AND COD_GRADO=11 THEN 'LABORAL 1'
      WHEN COD_ENSE=214 AND COD_GRADO=12 THEN 'LABORAL 2'
      WHEN COD_ENSE=214 AND COD_GRADO=13 THEN 'LABORAL 3'
      WHEN COD_ENSE=215 AND COD_GRADO=14 THEN 'PREBÁSICO MATERNO 1O (ESTIMULACIÓN TEMPRANA)'
      WHEN COD_ENSE=215 AND COD_GRADO=1 THEN 'PREBÁSICO 1'
      WHEN COD_ENSE=215 AND COD_GRADO=2 THEN 'PREBÁSICO 2'
      WHEN COD_ENSE=215 AND COD_GRADO=3 THEN 'PREBÁSICO 3'
      WHEN COD_ENSE=215 AND COD_GRADO=4 THEN 'PREBÁSICO 4'
      WHEN COD_ENSE=215 AND COD_GRADO=5 THEN 'PREBÁSICO 5'
      WHEN COD_ENSE=215 AND COD_GRADO=6 THEN 'BÁSICO 1'
      WHEN COD_ENSE=215 AND COD_GRADO=7 THEN 'BÁSICO 2'
      WHEN COD_ENSE=215 AND COD_GRADO=8 THEN 'BÁSICO 3'
      WHEN COD_ENSE=215 AND COD_GRADO=9 THEN 'BÁSICO 4'
      WHEN COD_ENSE=215 AND COD_GRADO=10 THEN 'BÁSICO 5'
      WHEN COD_ENSE=215 AND COD_GRADO=11 THEN 'BÁSICO 6'
      WHEN COD_ENSE=215 AND COD_GRADO=12 THEN 'BÁSICO 7'
      WHEN COD_ENSE=215 AND COD_GRADO=13 THEN 'BÁSICO 8'
      WHEN COD_ENSE=215 AND COD_GRADO=14 THEN 'BÁSICO 9'
      WHEN COD_ENSE=215 AND COD_GRADO=15 THEN 'BÁSICO 10'
      WHEN COD_ENSE=299 AND COD_GRADO=16 THEN 'LABORAL 1'
      WHEN COD_ENSE=299 AND COD_GRADO=17 THEN 'LABORAL 2'
      WHEN COD_ENSE=299 AND COD_GRADO=18 THEN 'LABORAL 3'
      WHEN COD_ENSE=299 AND COD_GRADO=19 THEN 'LABORAL 4'
      WHEN COD_ENSE=310 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=310 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=310 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=310 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=363 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=363 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O Y 4O MEDIO)'
      WHEN COD_ENSE=410 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=410 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=410 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=410 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=463 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=463 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O MEDIO)'
      WHEN COD_ENSE=463 AND COD_GRADO=4 THEN 'TERCERO NIVEL (4O MEDIO)'
      WHEN COD_ENSE=510 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=510 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=510 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=510 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=563 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=563 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O MEDIO)'
      WHEN COD_ENSE=563 AND COD_GRADO=4 THEN 'TERCERO NIVEL (4O MEDIO)'
      WHEN COD_ENSE=610 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=610 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=610 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=610 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=663 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=663 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O MEDIO)'
      WHEN COD_ENSE=663 AND COD_GRADO=4 THEN 'TERCERO NIVEL (4O MEDIO)'
      WHEN COD_ENSE=710 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=710 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=710 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=710 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=763 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=763 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O MEDIO)'
      WHEN COD_ENSE=763 AND COD_GRADO=4 THEN 'TERCERO NIVEL (4O MEDIO)'
      WHEN COD_ENSE=810 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=810 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=810 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=810 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=863 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=863 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O MEDIO)'
      WHEN COD_ENSE=863 AND COD_GRADO=4 THEN 'TERCERO NIVEL (4O MEDIO)'
      WHEN COD_ENSE=910 AND COD_GRADO=1 THEN '1O MEDIO'
      WHEN COD_ENSE=910 AND COD_GRADO=2 THEN '2O MEDIO'
      WHEN COD_ENSE=910 AND COD_GRADO=3 THEN '3O MEDIO'
      WHEN COD_ENSE=910 AND COD_GRADO=4 THEN '4O MEDIO'
      WHEN COD_ENSE=963 AND COD_GRADO=1 THEN 'PRIMER NIVEL (1O Y 2O MEDIO)'
      WHEN COD_ENSE=963 AND COD_GRADO=3 THEN 'SEGUNDO NIVEL (3O MEDIO)'
      WHEN COD_ENSE=963 AND COD_GRADO=4 THEN 'TERCERO NIVEL (4O MEDIO)'
      ELSE 'N/A'
      END
      AS COD_GRADO_GLOSA,

    LET_CUR,
    MRUN,
    GEN_ALU,
    CASE GEN_ALU
      WHEN 0 THEN 'SIN INFORMACION'
      WHEN 1 THEN 'EDUCACION PARVULARIA'
      WHEN 2 THEN 'ENSEÑANZA BASICA NIÑOS'
      ELSE 'N/A'
      END
      AS GEN_ALU_GLOSA,
    CASE FEC_NAC_ALU
      WHEN '190001' THEN 'SIN INFORMACION'
      WHEN '180001' THEN 'SIN INFORMACION'
      ELSE FEC_NAC_ALU
      END
      AS FEC_NAC_ALU,
    COD_COM_ALU,
    NOM_COM_ALU,
    DIAS_ASISTIDOS,
    DIAS_TRABAJADOS,
    ASIS_PROMEDIO,
    LAT_COMUNA, 
    LONG_COMUNA
  FROM
    `infinite-lens-352300.data_chile.asistencia` 
  WHERE 
    MES_ESCOLAR IS NOT NULL
  AND (
    AGNO IS NOT NULL OR
    MES_ESCOLAR IS NOT NULL OR
    RBD IS NOT NULL OR
    DGV_RBD IS NOT NULL OR
    NOM_RBD IS NOT NULL OR
    NOM_RBD != '' OR 
    COD_REG_RBD IS NOT NULL OR
    COD_REG_RBD != 0 OR
    NOM_REG_RBD_A IS NOT NULL OR
    COD_PRO_RBD IS NOT NULL OR
    COD_COM_RBD IS NOT NULL OR
    NOM_COM_RBD IS NOT NULL OR
    COD_DEPROV_RBD IS NOT NULL OR
    NOM_DEPROV_RBD IS NOT NULL OR
    RURAL_RBD IS NOT NULL OR
    COD_DEPE IS NOT NULL OR
    COD_DEPE2 IS NOT NULL OR
    COD_ENSE IS NOT NULL OR
    COD_ENSE2 IS NOT NULL OR
    COD_GRADO IS NOT NULL OR
    LET_CUR IS NOT NULL OR
    MRUN IS NOT NULL OR
    GEN_ALU IS NOT NULL OR
    FEC_NAC_ALU IS NOT NULL OR
    COD_COM_ALU IS NOT NULL OR
    NOM_COM_ALU IS NOT NULL OR
    DIAS_ASISTIDOS IS NOT NULL OR
    DIAS_TRABAJADOS IS NOT NULL OR
    ASIS_PROMEDIO IS NOT NULL
  )
);
```

